---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
    name: reports
    labels:
        app: reports
        type: reports
        logtype: stream
spec:
    replicas: 3
    template:
        metadata:
            labels:
                app: reports
                type: reports
                logtype: archive
        spec:
            containers:
                - name: reports
                  image: nginx:<%= @parameters['image_tag'] %>
                  imagePullPolicy: Always
                  livenessProbe:
                      tcpSocket:
                          port: 80
                      initialDelaySeconds: 20
                      timeoutSeconds: 5
                  readinessProbe:
                      tcpSocket:
                          port: 80
                      initialDelaySeconds: 30
                      timeoutSeconds: 5
                  volumeMounts:
                    - name: html
                      mountPath: /usr/share/nginx/html
            volumes:
                - name: html
                  azureFile: 
                      secretName: reports
                      shareName: reports
                      readOnly: true
